(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{2352:(e,t,n)=>{Promise.resolve().then(n.bind(n,9817))},9817:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var s=n(5155),a=n(8173),r=n.n(a),o=n(2115),c=n(6046),i=n(5739),l=n(4651);function d(){let e=(0,c.useRouter)(),[t,n]=(0,o.useState)(""),[a,d]=(0,o.useState)(""),[u,h]=(0,o.useState)([]),[m,g]=(0,o.useState)([]),[f,x]=(0,o.useState)([]),[p,v]=(0,o.useState)("Listo"),j=(0,o.useMemo)(()=>[...m].filter(e=>"cancelled"!==e.status).sort((e,t)=>new Date(e.start_dt).getTime()-new Date(t.start_dt).getTime())[0],[m]);async function I(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;try{let[t,s,a]=await Promise.all([(0,i.A)("/services",{token:e,tenantId:n}),(0,i.A)("/appointments",{token:e,tenantId:n}),(0,i.A)("/waitlists",{token:e,tenantId:n})]);h(t),g(s),x(a),v("Datos actualizados")}catch(e){v("Error: ".concat(e.message))}}async function k(){if(!j){v("No hay turnos para cancelar.");return}try{await (0,i.A)("/appointments/".concat(j.id,"/cancel"),{method:"POST",token:t,tenantId:a}),v("Turno ".concat(j.id," cancelado")),await I()}catch(e){v("Error cancelando: ".concat(e.message))}}return(0,o.useEffect)(()=>{let t=(0,l.Ht)();if(!t.token||!t.tenantId){e.replace("/login");return}n(t.token),d(t.tenantId),I(t.token,t.tenantId)},[e]),(0,s.jsxs)("main",{children:[(0,s.jsx)("div",{className:"brand",children:"NILA"}),(0,s.jsx)("div",{className:"brandTag",children:"Strategy \xb7 Technology \xb7 Execution"}),(0,s.jsx)("h1",{className:"sectionTitle",children:"Dashboard Cliente"}),(0,s.jsxs)("div",{className:"grid",children:[(0,s.jsxs)("section",{className:"card",children:[(0,s.jsx)("h2",{children:"Proximo turno"}),j?(0,s.jsxs)("p",{children:["Turno #",j.id," - ",new Date(j.start_dt).toLocaleString()]}):(0,s.jsx)("p",{children:"Sin turnos activos."})]}),(0,s.jsxs)("section",{className:"card",children:[(0,s.jsx)("h2",{children:"Servicios disponibles"}),(0,s.jsxs)("p",{children:[u.length," servicios activos en tu tenant."]})]}),(0,s.jsxs)("section",{className:"card",children:[(0,s.jsx)("h2",{children:"Mis turnos"}),(0,s.jsxs)("p",{children:["Total: ",m.length]})]}),(0,s.jsxs)("section",{className:"card",children:[(0,s.jsx)("h2",{children:"Lista de espera"}),(0,s.jsxs)("p",{children:["Registros activos: ",f.filter(e=>"active"===e.status).length]})]})]}),(0,s.jsxs)("div",{className:"linkRow",children:[(0,s.jsx)("button",{className:"linkBtn",onClick:()=>I(),children:"Refrescar"}),(0,s.jsx)("button",{className:"mutedBtn",onClick:k,children:"Cancelar proximo turno"}),(0,s.jsx)(r(),{className:"linkBtn",href:"/client/marketplace",children:"Ir a marketplace"}),(0,s.jsx)(r(),{className:"mutedBtn",href:"/client/workspace",children:"Workspace"}),(0,s.jsx)("button",{className:"mutedBtn",onClick:function(){(0,l.q7)(),e.push("/login")},children:"Cerrar sesion"})]}),(0,s.jsx)("pre",{className:"pre",children:p})]})}},5739:(e,t,n)=>{"use strict";n.d(t,{A:()=>r,e:()=>o});let s="/api";async function a(e,t){let n=e.length>1&&e.endsWith("/")?e.slice(0,-1):e,a=["".concat(s).concat(n),"".concat(s).concat(n,"/")];for(let e=0;e<a.length;e+=1)try{let n=await fetch(a[e],t);if(404!==n.status||e===a.length-1)return n}catch(t){if(e===a.length-1)throw Error("Network error while contacting API")}throw Error("Unexpected API routing state")}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};t.token&&(n.Authorization="Bearer ".concat(t.token)),t.tenantId&&(n["X-Tenant-ID"]=t.tenantId),void 0!==t.body&&(n["Content-Type"]="application/json");let s=await a(e,{method:t.method||"GET",headers:n,body:void 0!==t.body?JSON.stringify(t.body):void 0});if(!s.ok){let e=await s.text();throw Error("".concat(s.status," ").concat(s.statusText," :: ").concat(e))}return 204===s.status?{}:s.json()}function o(){return s}},4651:(e,t,n)=>{"use strict";n.d(t,{E1:()=>d,Ht:()=>l,dM:()=>u,q7:()=>h});let s="nila_token",a="nila_tenant_id",r="nila_user",o="nila_remember";function c(e){let t=localStorage.getItem(e);return null!==t?t:sessionStorage.getItem(e)||""}function i(e){localStorage.removeItem(e),sessionStorage.removeItem(e)}function l(){let e;let t=c(s),n=c(a),o=c(r);if(o)try{e=JSON.parse(o)}catch(t){e=void 0}return{token:t,tenantId:n,user:e}}function d(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=t?localStorage:sessionStorage,c=t?sessionStorage:localStorage;n.setItem(s,e.token),n.setItem(a,e.tenantId),e.user&&n.setItem(r,JSON.stringify(e.user)),n.setItem(o,t?"1":"0"),c.removeItem(s),c.removeItem(a),c.removeItem(r),c.removeItem(o)}function u(e){localStorage.setItem(a,e)}function h(){i(s),i(a),i(r),i(o)}},6046:(e,t,n)=>{"use strict";var s=n(6658);n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[173,441,517,358],()=>t(2352)),_N_E=e.O()}]);